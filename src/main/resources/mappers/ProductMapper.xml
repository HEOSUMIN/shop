<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.pro.shop.product.model.dao.ProductMapper">

	<!-- 상품 조회용 -->
	<resultMap id="productResultMap" type="com.pro.shop.product.model.dto.ProductDTO">
		<id property="prodNo" column="PROD_NO"/>
		<result property="categoryNo" column="CATEGORY_NO"/>
		<result property="brandNo" column="BRAND_NO"/>
		<result property="prodName" column="PROD_NAME"/>
		<result property="prodDesc" column="PROD_DESC"/>
		<result property="discountRate" column="DISCOUNT_RATE"/>
		<result property="prodPrice" column="PROD_PRICE"/>
		<result property="prodSize" column="PROD_SIZE"/>
		<result property="prodColor" column="PROD_COLOR"/>
		<result property="prodDetailContent" column="PROD_DETAIL_CONTENT"/>
		<result property="prodDetailViewCount" column="PROD_DETAIL_VIEW_COUNT"/>
		<result property="prodInstDate" column="PROD_INST_DATE"/>
		<result property="prodUdtDate" column="PROD_UDT_DATE"/>
		<result property="prodAvailYn" column="PROD_AVAIL_YN"/>
		<association property="category" resultMap="categoryResultMap"/> <!-- 1:1 -->
		<association property="brand" resultMap="brandResultMap"/> <!-- 1:1 -->
	<!-- 	<association property="attachmentList" resultMap="thumbnailResultMap"/> 1:1 -->
		<!-- <collection property="option" resultMap="optionResultMap"/> 1:N -->
	</resultMap>

	<!-- 카테고리 조회용 -->
	<resultMap id="categoryResultMap" type="com.pro.shop.product.model.dto.CategoryDTO">
		<id property="categoryNo" column="CATEGORY_NO"/>
		<result property="categoryName" column="CATEGORY_NAME"/>
		<result property="categorySection" column="CATEGORY_SECTION"/>
	</resultMap>
	
	<!-- 브랜드 조회용 -->
	<resultMap id="brandResultMap" type="com.pro.shop.product.model.dto.BrandDTO">
		<id property="brandNo" column="BRAND_NO"/>
		<result property="brandName" column="BRAND_NAME"/>
	</resultMap>
	

	<!-- 카테고리 목록 조회 -->
	<select id="getCategoryList" resultMap="categoryResultMap">
		SELECT * FROM TBL_CATEGORY
	</select>

	<!-- 카테고리 번호 조회 -->
	<select id="checkCategoryNo" parameterType="String" resultType="int">
		SELECT
			   CATEGORY_NO
		  FROM TBL_CATEGORY
		 WHERE CATEGORY_NAME = #{ categoryName }
	</select>
	
	
	<!-- 브랜드 목록 조회 -->
	<select id="getBrandList" resultMap="brandResultMap">
		SELECT * FROM TBL_BRAND
	</select>

	<!-- 브랜드 번호 조회 -->
	<select id="checkBrandNo" parameterType="String" resultType="int">
		SELECT
			   BRAND_NO
		  FROM TBL_BRAND
		 WHERE BRAND_NAME = #{ brandName }
	</select>
	
	<!-- 상품 등록 -->
	<insert id="addProduct">
		INSERT
		  INTO TBL_PRODUCT
		(
			PROD_NO
			,CATEGORY_NO
			,BRAND_NO
			,PROD_NAME
			,PROD_DESC
			,PROD_PRICE
			,DISCOUNT_RATE
			<!-- ,PROD_DETAIL_CONTENT -->
			,PROD_DETAIL_VIEW_COUNT
			,PROD_INST_DATE
			,PROD_UPT_DATE	
			,PROD_AVAIL_YN
			,PROD_SIZE
			,PROD_COLOR 
		)
		VALUES
		(
		  SEQ_PROD_NO.NEXTVAL
		, #{ categoryNo}
	 , #{ brandNo }
		, #{ prodName }
		, #{ prodDesc }
		, #{ prodPrice }
		, #{ discountRate }
	<!-- 	, #{ prodDetailContent } -->
	 	, DEFAULT
		, SYSDATE
		, SYSDATE
		, DEFAULT
		, #{ prodSize }
		, #{ prodColor } 
		)
	</insert>
	
	<!-- 현재 상품번호 조회 -->
	<select id="checkCurrProdNo" resultType="int">
		SELECT
			   SEQ_PROD_NO.CURRVAL
		  FROM DUAL
	</select>
	
	
	<!-- 상품 썸네일 등록 -->
	<insert id="attachProdThumbnail">
		INSERT
		  INTO TBL_ATTACHMENT
		(
		  ATTACHMENT_NO
		, REF_PROD_NO
		, REF_REVW_NO
		, REF_INQ_NO
		, ORIG_FILE_NAME
		, SAVE_FILE_NAME
		, SAVE_PATH
		, THUMBNAIL_PATH
		, FILE_TYPE
		, ATTACH_STATUS_YN
		)
		VALUES
		(
		  SEQ_ATTACH_NO.NEXTVAL
		, #{ refProdNo }
		, NULL
		, NULL
		, #{ origFileName }
		, #{ saveFileName }
		, #{ savePath }
		, #{ thumbnailPath }
		, #{ fileType }
		, DEFAULT
		)
	</insert>
	
</mapper>